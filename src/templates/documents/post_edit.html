{% extends "base.html" %}

{% block title %}Post-Eintrag bearbeiten - StitchAdmin{% endblock %}

{% block content %}
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<div class="row">
    <div class="col-md-12">
        <h1><i class="bi bi-pencil"></i> Post-Eintrag bearbeiten</h1>
        <div class="mb-3">
            <a href="{{ url_for('documents.post_view', id=entry.id) }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Zurück
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-10 offset-md-1">
        <div class="card">
            <div class="card-body">
                <form method="POST" action="{{ url_for('documents.post_edit', id=entry.id) }}">

                    <!-- Basis-Daten -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label"><i class="bi bi-arrow-left-right"></i> Richtung *</label>
                            <select class="form-control" name="direction" required>
                                <option value="inbound" {% if entry.direction == 'inbound' %}selected{% endif %}>Eingang (empfangen)</option>
                                <option value="outbound" {% if entry.direction == 'outbound' %}selected{% endif %}>Ausgang (versendet)</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label"><i class="bi bi-envelope"></i> Art *</label>
                            <select class="form-control" name="type" required>
                                <option value="brief" {% if entry.type == 'brief' %}selected{% endif %}>Brief</option>
                                <option value="einschreiben" {% if entry.type == 'einschreiben' %}selected{% endif %}>Einschreiben</option>
                                <option value="einschreiben_rueckschein" {% if entry.type == 'einschreiben_rueckschein' %}selected{% endif %}>Einschreiben mit Rückschein</option>
                                <option value="paket" {% if entry.type == 'paket' %}selected{% endif %}>Paket</option>
                                <option value="fax" {% if entry.type == 'fax' %}selected{% endif %}>Fax</option>
                                <option value="email" {% if entry.type == 'email' %}selected{% endif %}>E-Mail</option>
                            </select>
                        </div>
                    </div>

                    <!-- Betreff -->
                    <div class="mb-3">
                        <label class="form-label"><i class="bi bi-chat-left-text"></i> Betreff *</label>
                        <input type="text" class="form-control" name="subject" required value="{{ entry.subject }}">
                    </div>

                    <!-- Absender/Empfänger -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label"><i class="bi bi-person-fill"></i> Absender</label>
                            <input type="text" class="form-control" name="sender" value="{{ entry.sender or '' }}">
                            <textarea class="form-control mt-2" name="sender_address" rows="2" placeholder="Adresse des Absenders (optional)">{{ entry.sender_address or '' }}</textarea>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label"><i class="bi bi-person"></i> Empfänger</label>
                            <input type="text" class="form-control" name="recipient" value="{{ entry.recipient or '' }}">
                            <textarea class="form-control mt-2" name="recipient_address" rows="2" placeholder="Adresse des Empfängers (optional)">{{ entry.recipient_address or '' }}</textarea>
                        </div>
                    </div>

                    <!-- Verknüpfungen -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label"><i class="bi bi-people"></i> Kunde</label>
                            <select class="form-control" name="customer_id">
                                <option value="">Kein Kunde zugeordnet</option>
                                {% for customer in customers %}
                                <option value="{{ customer.id }}" {% if entry.customer_id == customer.id %}selected{% endif %}>
                                    {{ customer.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label"><i class="bi bi-hash"></i> Referenznummer</label>
                            <input type="text" class="form-control" name="reference_number" value="{{ entry.reference_number or '' }}">
                        </div>
                    </div>

                    <!-- Tracking (für Versand) -->
                    <div class="card mb-3 border-info">
                        <div class="card-header bg-info text-white">
                            <i class="bi bi-truck"></i> Tracking & Versand (optional)
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Sendungsnummer</label>
                                    <input type="text" class="form-control" name="tracking_number" value="{{ entry.tracking_number or '' }}">
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">Versanddienstleister</label>
                                    <select class="form-control" name="carrier">
                                        <option value="">-</option>
                                        <option value="DHL" {% if entry.carrier == 'DHL' %}selected{% endif %}>DHL</option>
                                        <option value="DPD" {% if entry.carrier == 'DPD' %}selected{% endif %}>DPD</option>
                                        <option value="Hermes" {% if entry.carrier == 'Hermes' %}selected{% endif %}>Hermes</option>
                                        <option value="Deutsche Post" {% if entry.carrier == 'Deutsche Post' %}selected{% endif %}>Deutsche Post</option>
                                        <option value="GLS" {% if entry.carrier == 'GLS' %}selected{% endif %}>GLS</option>
                                        <option value="UPS" {% if entry.carrier == 'UPS' %}selected{% endif %}>UPS</option>
                                        <option value="FedEx" {% if entry.carrier == 'FedEx' %}selected{% endif %}>FedEx</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Versandkosten</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" name="shipping_cost"
                                               step="0.01" min="0" value="{{ entry.shipping_cost or '' }}">
                                        <span class="input-group-text">€</span>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">Zustellstatus</label>
                                    <select class="form-control" name="delivery_status">
                                        <option value="">-</option>
                                        <option value="pending" {% if entry.delivery_status == 'pending' %}selected{% endif %}>Ausstehend</option>
                                        <option value="in_transit" {% if entry.delivery_status == 'in_transit' %}selected{% endif %}>Unterwegs</option>
                                        <option value="delivered" {% if entry.delivery_status == 'delivered' %}selected{% endif %}>Zugestellt</option>
                                        <option value="returned" {% if entry.delivery_status == 'returned' %}selected{% endif %}>Zurückgekommen</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Zugestellt am</label>
                                    <input type="datetime-local" class="form-control" name="delivery_date"
                                           value="{% if entry.delivery_date %}{{ entry.delivery_date.strftime('%Y-%m-%dT%H:%M') }}{% endif %}">
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">Unterschrift empfangen</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="signature_received"
                                               id="signatureReceived" {% if entry.signature_received %}checked{% endif %}>
                                        <label class="form-check-label" for="signatureReceived">
                                            Ja, Unterschrift vorhanden
                                        </label>
                                    </div>
                                    <input type="text" class="form-control mt-2" name="signature_name"
                                           placeholder="Name des Unterzeichners" value="{{ entry.signature_name or '' }}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status & Priorität -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label"><i class="bi bi-circle-fill"></i> Status</label>
                            <select class="form-control" name="status">
                                <option value="open" {% if entry.status == 'open' %}selected{% endif %}>Offen</option>
                                <option value="in_progress" {% if entry.status == 'in_progress' %}selected{% endif %}>In Bearbeitung</option>
                                <option value="completed" {% if entry.status == 'completed' %}selected{% endif %}>Erledigt</option>
                                <option value="archived" {% if entry.status == 'archived' %}selected{% endif %}>Archiviert</option>
                            </select>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label"><i class="bi bi-flag-fill"></i> Priorität</label>
                            <select class="form-control" name="priority">
                                <option value="low" {% if entry.priority == 'low' %}selected{% endif %}>Niedrig</option>
                                <option value="normal" {% if entry.priority == 'normal' %}selected{% endif %}>Normal</option>
                                <option value="high" {% if entry.priority == 'high' %}selected{% endif %}>Hoch</option>
                                <option value="urgent" {% if entry.priority == 'urgent' %}selected{% endif %}>Dringend</option>
                            </select>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label"><i class="bi bi-calendar-event"></i> Fälligkeitsdatum</label>
                            <input type="date" class="form-control" name="due_date"
                                   value="{% if entry.due_date %}{{ entry.due_date.strftime('%Y-%m-%d') }}{% endif %}">
                        </div>
                    </div>

                    <!-- Wiedervorlage -->
                    <div class="mb-3">
                        <label class="form-label"><i class="bi bi-alarm"></i> Wiedervorlage am</label>
                        <input type="date" class="form-control" name="reminder_date"
                               value="{% if entry.reminder_date %}{{ entry.reminder_date.strftime('%Y-%m-%d') }}{% endif %}">
                    </div>

                    <!-- Beschreibung -->
                    <div class="mb-3">
                        <label class="form-label"><i class="bi bi-text-paragraph"></i> Beschreibung / Notizen</label>
                        <textarea class="form-control" name="notes" rows="5">{{ entry.notes or entry.description or '' }}</textarea>
                    </div>

                    <!-- Buttons -->
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('documents.post_view', id=entry.id) }}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Abbrechen
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Änderungen speichern
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}
