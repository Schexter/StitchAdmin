{% extends "setup/base_setup.html" %}
{% block title %}E-Mail-Einstellungen{% endblock %}

{% block content %}
<div class="step-indicator">
    <div class="step-number">üìß</div>
    <h3 class="mt-3">E-Mail-Versand</h3>
    <p class="text-muted">Wie sollen Rechnungen und Angebote versendet werden?</p>
</div>

<form method="POST">
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-paper-plane me-2"></i>Versandmethode</h5>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <div class="form-check card p-3 h-100">
                        <input class="form-check-input" type="radio" name="email_method" 
                               id="method_outlook" value="outlook" 
                               {% if settings.email_method == 'outlook' or not settings.email_method %}checked{% endif %}>
                        <label class="form-check-label" for="method_outlook">
                            <i class="fab fa-microsoft fa-2x text-primary mb-2"></i><br>
                            <strong>Outlook</strong>
                            <br><small class="text-muted">√ñffnet lokales Outlook</small>
                            <br><span class="badge bg-success">Empfohlen</span>
                        </label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-check card p-3 h-100">
                        <input class="form-check-input" type="radio" name="email_method" 
                               id="method_smtp" value="smtp"
                               {% if settings.email_method == 'smtp' %}checked{% endif %}>
                        <label class="form-check-label" for="method_smtp">
                            <i class="fas fa-server fa-2x text-info mb-2"></i><br>
                            <strong>SMTP-Server</strong>
                            <br><small class="text-muted">Direkter Versand</small>
                        </label>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-check card p-3 h-100">
                        <input class="form-check-input" type="radio" name="email_method" 
                               id="method_mailto" value="mailto"
                               {% if settings.email_method == 'mailto' %}checked{% endif %}>
                        <label class="form-check-label" for="method_mailto">
                            <i class="fas fa-envelope fa-2x text-secondary mb-2"></i><br>
                            <strong>Standard-Mailprogramm</strong>
                            <br><small class="text-muted">mailto:-Link</small>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SMTP-Einstellungen (nur sichtbar wenn SMTP ausgew√§hlt) -->
    <div class="card mb-4" id="smtpSettings" style="display: none;">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-cog me-2"></i>SMTP-Konfiguration</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8 mb-3">
                    <label class="form-label">SMTP-Server</label>
                    <input type="text" name="smtp_server" class="form-control" 
                           value="{{ settings.smtp_server or '' }}" placeholder="smtp.example.com">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Port</label>
                    <input type="number" name="smtp_port" class="form-control" 
                           value="{{ settings.smtp_port or 587 }}">
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Benutzername</label>
                    <input type="text" name="smtp_username" class="form-control" 
                           value="{{ settings.smtp_username or '' }}" placeholder="user@example.com">
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Passwort</label>
                    <input type="password" name="smtp_password" class="form-control" 
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
            </div>
            
            <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="smtp_use_tls" name="smtp_use_tls"
                       {% if settings.smtp_use_tls %}checked{% endif %}>
                <label class="form-check-label" for="smtp_use_tls">
                    TLS/STARTTLS verwenden (empfohlen)
                </label>
            </div>
            
            <hr>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Absender E-Mail</label>
                    <input type="email" name="smtp_from_email" class="form-control" 
                           value="{{ settings.smtp_from_email or '' }}" placeholder="rechnung@firma.de">
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Absender Name</label>
                    <input type="text" name="smtp_from_name" class="form-control" 
                           value="{{ settings.smtp_from_name or '' }}" placeholder="Mustermann Stickerei">
                </div>
            </div>
        </div>
    </div>
    
    <div class="alert alert-light">
        <i class="fas fa-lightbulb me-2"></i>
        <strong>Outlook-Integration:</strong> Beim E-Mail-Versand √∂ffnet sich Outlook mit vorausgef√ºllter E-Mail.
        Sie k√∂nnen den Text vor dem Versand noch anpassen. PDF-Anh√§nge werden automatisch hinzugef√ºgt.
    </div>
    
    <div class="d-flex justify-content-between mt-4">
        <a href="{{ url_for('setup.bank') }}" class="btn btn-outline-secondary btn-setup">
            <i class="fas fa-arrow-left me-2"></i> Zur√ºck
        </a>
        <button type="submit" class="btn btn-primary btn-setup">
            Weiter <i class="fas fa-arrow-right ms-2"></i>
        </button>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
function toggleSmtpSettings() {
    const smtp = document.getElementById('method_smtp').checked;
    document.getElementById('smtpSettings').style.display = smtp ? 'block' : 'none';
}

document.querySelectorAll('input[name="email_method"]').forEach(el => {
    el.addEventListener('change', toggleSmtpSettings);
});

toggleSmtpSettings();
</script>
{% endblock %}
