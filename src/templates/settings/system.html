{% extends "base.html" %}

{% block title %}System-Informationen - StitchAdmin{% endblock %}

{% block content %}
<!-- Erstellt von Hans Hahn - Alle Rechte vorbehalten -->

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1><i class="bi bi-info-circle"></i> System-Informationen</h1>
        <p class="text-muted">Übersicht über die Systemkonfiguration und -status</p>
    </div>
    <div>
        <button class="btn btn-outline-primary" onclick="refreshSystemInfo()">
            <i class="bi bi-arrow-clockwise"></i> Aktualisieren
        </button>
        <a href="{{ url_for('settings.index') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Zurück
        </a>
    </div>
</div>

<!-- System-Status -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-cpu text-primary" style="font-size: 2rem;"></i>
                <h5 class="card-title mt-2">System</h5>
                <p class="card-text">
                    <span class="badge bg-success">Online</span><br>
                    <small class="text-muted">StitchAdmin v1.0</small>
                </p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-database text-success" style="font-size: 2rem;"></i>
                <h5 class="card-title mt-2">Datenbank</h5>
                <p class="card-text">
                    <span class="badge bg-success">Verbunden</span><br>
                    <small class="text-muted">SQLite</small>
                </p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-shield-check text-info" style="font-size: 2rem;"></i>
                <h5 class="card-title mt-2">Sicherheit</h5>
                <p class="card-text">
                    {% if config.get('DEBUG') %}
                        <span class="badge bg-warning">Debug-Modus</span>
                    {% else %}
                        <span class="badge bg-success">Produktiv</span>
                    {% endif %}<br>
                    <small class="text-muted">Flask Login</small>
                </p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-gear text-warning" style="font-size: 2rem;"></i>
                <h5 class="card-title mt-2">Services</h5>
                <p class="card-text">
                    <span class="badge bg-success">3 aktiv</span><br>
                    <small class="text-muted">Web, DB, Auth</small>
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Detaillierte Informationen -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-server"></i> Server-Informationen</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-5">Python Version:</dt>
                    <dd class="col-sm-7">
                        <code>{{ system_info.python_version.split()[0] if system_info.python_version else 'Unbekannt' }}</code>
                    </dd>

                    <dt class="col-sm-5">Betriebssystem:</dt>
                    <dd class="col-sm-7">
                        <code>{{ system_info.platform if system_info.platform else 'Unbekannt' }}</code>
                    </dd>

                    <dt class="col-sm-5">Flask Debug:</dt>
                    <dd class="col-sm-7">
                        {% if system_info.flask_debug %}
                            <span class="badge bg-warning">Aktiviert</span>
                        {% else %}
                            <span class="badge bg-success">Deaktiviert</span>
                        {% endif %}
                    </dd>

                    <dt class="col-sm-5">Server-Zeit:</dt>
                    <dd class="col-sm-7">
                        <span id="serverTime">{{ moment().format('DD.MM.YYYY HH:mm:ss') if moment else 'Unbekannt' }}</span>
                    </dd>

                    <dt class="col-sm-5">Uptime:</dt>
                    <dd class="col-sm-7">
                        <span id="uptime">Wird geladen...</span>
                    </dd>
                </dl>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-database"></i> Datenbank-Informationen</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-5">Datenbank-Typ:</dt>
                    <dd class="col-sm-7">
                        {% if 'sqlite' in system_info.database_url.lower() %}
                            <code>SQLite</code>
                        {% elif 'postgresql' in system_info.database_url.lower() %}
                            <code>PostgreSQL</code>
                        {% elif 'mysql' in system_info.database_url.lower() %}
                            <code>MySQL</code>
                        {% else %}
                            <code>Unbekannt</code>
                        {% endif %}
                    </dd>

                    <dt class="col-sm-5">Verbindung:</dt>
                    <dd class="col-sm-7">
                        <span class="badge bg-success">Aktiv</span>
                    </dd>

                    <dt class="col-sm-5">Datei/Host:</dt>
                    <dd class="col-sm-7">
                        <small class="text-break">
                            {% if 'sqlite' in system_info.database_url.lower() %}
                                {{ system_info.database_url.split(':///')[-1] if ':///' in system_info.database_url else 'stitchadmin.db' }}
                            {% else %}
                                {{ system_info.database_url.split('@')[-1].split('/')[0] if '@' in system_info.database_url else 'localhost' }}
                            {% endif %}
                        </small>
                    </dd>

                    <dt class="col-sm-5">Schema-Version:</dt>
                    <dd class="col-sm-7">
                        <span class="badge bg-info">v1.0</span>
                    </dd>

                    <dt class="col-sm-5">Tabellen:</dt>
                    <dd class="col-sm-7">
                        <span id="tableCount">Wird geladen...</span>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</div>

<!-- Installierte Pakete -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-box"></i> Wichtige Pakete</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <h6>Core Framework</h6>
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-success"></i> Flask</li>
                            <li><i class="bi bi-check-circle text-success"></i> SQLAlchemy</li>
                            <li><i class="bi bi-check-circle text-success"></i> Flask-Login</li>
                            <li><i class="bi bi-check-circle text-success"></i> Werkzeug</li>
                        </ul>
                    </div>
                    
                    <div class="col-md-3">
                        <h6>Datenverarbeitung</h6>
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-success"></i> Pandas</li>
                            <li><i class="bi bi-check-circle text-success"></i> Openpyxl</li>
                            <li><i class="bi bi-check-circle text-success"></i> Python-dotenv</li>
                            <li><i class="bi bi-check-circle text-success"></i> Requests</li>
                        </ul>
                    </div>
                    
                    <div class="col-md-3">
                        <h6>PDF/Dokumente</h6>
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-success"></i> PDFplumber</li>
                            <li><i class="bi bi-check-circle text-success"></i> ReportLab</li>
                            <li><i class="bi bi-check-circle text-success"></i> Pillow</li>
                        </ul>
                    </div>
                    
                    <div class="col-md-3">
                        <h6>Utilities</h6>
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-success"></i> Cryptography</li>
                            <li><i class="bi bi-check-circle text-success"></i> Alembic</li>
                            <li><i class="bi bi-check-circle text-success"></i> Click</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System-Logs -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="bi bi-file-text"></i> System-Logs (letzte 10 Einträge)</h5>
                <div>
                    <button class="btn btn-sm btn-outline-primary" onclick="downloadLogs()">
                        <i class="bi bi-download"></i> Log herunterladen
                    </button>
                    <button class="btn btn-sm btn-outline-warning" onclick="clearLogs()">
                        <i class="bi bi-trash"></i> Logs löschen
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="systemLogs" style="max-height: 300px; overflow-y: auto;">
                    <pre class="text-muted">Lade System-Logs...</pre>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System-Aktionen -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-tools"></i> System-Aktionen</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="d-grid">
                            <button class="btn btn-outline-info" onclick="runDatabaseMaintenance()">
                                <i class="bi bi-database-gear"></i> DB-Wartung
                            </button>
                        </div>
                        <small class="text-muted">Optimiert die Datenbank</small>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="d-grid">
                            <button class="btn btn-outline-success" onclick="createBackup()">
                                <i class="bi bi-shield-check"></i> Backup erstellen
                            </button>
                        </div>
                        <small class="text-muted">Erstellt vollständiges Backup</small>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="d-grid">
                            <button class="btn btn-outline-warning" onclick="checkSystemHealth()">
                                <i class="bi bi-heart-pulse"></i> System-Check
                            </button>
                        </div>
                        <small class="text-muted">Prüft System-Gesundheit</small>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="d-grid">
                            <button class="btn btn-outline-danger" onclick="restartSystem()" disabled>
                                <i class="bi bi-arrow-clockwise"></i> Neustart
                            </button>
                        </div>
                        <small class="text-muted">Nicht verfügbar</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Erstellt von Hans Hahn - Alle Rechte vorbehalten

// System-Zeit aktualisieren
function updateServerTime() {
    const now = new Date();
    document.getElementById('serverTime').textContent = now.toLocaleString('de-DE');
}

// Uptime berechnen (simuliert)
function updateUptime() {
    const startTime = new Date(Date.now() - Math.random() * 86400000); // Zufällige Uptime bis 24h
    const uptime = Math.floor((Date.now() - startTime) / 1000);
    
    const hours = Math.floor(uptime / 3600);
    const minutes = Math.floor((uptime % 3600) / 60);
    const seconds = uptime % 60;
    
    document.getElementById('uptime').textContent = `${hours}h ${minutes}m ${seconds}s`;
}

// System-Informationen aktualisieren
function refreshSystemInfo() {
    location.reload();
}

// Tabellen-Anzahl laden (vereinfacht)
function loadTableCount() {
    // Vereinfachte Anzeige ohne API-Aufruf
    document.getElementById('tableCount').textContent = 'SQLite Datenbank';
}

// System-Logs laden (vereinfacht)
function loadSystemLogs() {
    // Vereinfachte Anzeige ohne API-Aufruf
    const logsDiv = document.getElementById('systemLogs');
    logsDiv.innerHTML = '<p class="text-muted">System läuft stabil - keine kritischen Logs</p>';
}

// System-Aktionen
function runDatabaseMaintenance() {
    if (confirm('Möchten Sie die Datenbank-Wartung starten? Dies kann einige Minuten dauern.')) {
        // Implementierung folgt
        alert('Datenbank-Wartung gestartet (Demo)');
    }
}

function createBackup() {
    if (confirm('Möchten Sie ein vollständiges System-Backup erstellen?')) {
        // Implementierung folgt
        alert('Backup wird erstellt (Demo)');
    }
}

function checkSystemHealth() {
    // Implementierung folgt
    alert('System-Check: Alle Systeme funktional (Demo)');
}

function downloadLogs() {
    // Implementierung folgt
    alert('Log-Download wird vorbereitet (Demo)');
}

function clearLogs() {
    if (confirm('Möchten Sie wirklich alle System-Logs löschen?')) {
        // Implementierung folgt
        alert('Logs werden gelöscht (Demo)');
    }
}

// Initialisierung
document.addEventListener('DOMContentLoaded', function() {
    updateServerTime();
    updateUptime();
    loadTableCount();
    loadSystemLogs();
    
    // Zeit alle 5 Sekunden aktualisieren
    setInterval(updateServerTime, 5000);
    setInterval(updateUptime, 1000);
});
</script>
{% endblock %}
