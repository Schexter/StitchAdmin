{% extends "base.html" %}

{% block title %}Packliste - Auftrag {{ order.id }} - StitchAdmin{% endblock %}

{% block content %}
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <!-- Druckbare Packliste -->
            <div class="card">
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h2><i class="bi bi-box-seam"></i> PACKLISTE</h2>
                            <p class="text-muted">Auftrag: <strong>{{ order.id }}</strong></p>
                        </div>
                        <div class="col-md-6 text-end">
                            <p class="mb-1"><strong>Datum:</strong> {{ generated_at.strftime('%d.%m.%Y') }}</p>
                            <p class="mb-1"><strong>Zeit:</strong> {{ generated_at.strftime('%H:%M') }}</p>
                            <p class="mb-0"><strong>Bearbeiter:</strong> {{ session.username }}</p>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5><i class="bi bi-person"></i> Kundeninformationen</h5>
                            {% if customer %}
                            <address>
                                <strong>{{ customer.first_name }} {{ customer.last_name }}</strong><br>
                                {{ customer.street }} {{ customer.house_number }}<br>
                                {{ customer.postal_code }} {{ customer.city }}<br>
                                {{ customer.country or 'Deutschland' }}
                                {% if customer.phone %}
                                    <br>Tel: {{ customer.phone }}
                                {% endif %}
                            </address>
                            {% else %}
                            <p class="text-danger">Kundenadresse nicht verfügbar</p>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <h5><i class="bi bi-clipboard-data"></i> Auftragsdetails</h5>
                            <table class="table table-sm">
                                <tr>
                                    <td><strong>Auftrag:</strong></td>
                                    <td>{{ order.id }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Typ:</strong></td>
                                    <td>
                                        {% if order.order_type == 'embroidery' %}
                                            Bestickung
                                        {% elif order.order_type == 'printing' %}
                                            Textildruck
                                        {% elif order.order_type == 'combined' %}
                                            Kombiniert
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Priorität:</strong></td>
                                    <td>
                                        {% if order.priority == 'urgent' %}
                                            <strong class="text-danger">DRINGEND</strong>
                                        {% elif order.priority == 'high' %}
                                            <strong class="text-warning">HOCH</strong>
                                        {% else %}
                                            {{ order.priority|title }}
                                        {% endif %}
                                        {% if order.rush_order %}
                                            <br><strong class="text-danger">⚡ EXPRESS</strong>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Wert:</strong></td>
                                    <td><strong>{{ "%.2f"|format(order.price) }} €</strong></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-12">
                            <h5><i class="bi bi-list-check"></i> Artikel & Spezifikationen</h5>
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Artikel</th>
                                        <th>Menge</th>
                                        <th>Größe</th>
                                        <th>Design/Druck</th>
                                        <th>Spezifikationen</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>{{ order.textile_type|title or 'Textil' }}</td>
                                        <td><strong>{{ order.quantity }}</strong></td>
                                        <td>{{ order.size or 'Standard' }}</td>
                                        <td>{{ order.design_description or order.description }}</td>
                                        <td>
                                            {% if order.order_type == 'embroidery' %}
                                                <small>
                                                    <strong>Stiche:</strong> {{ "{:,}".format(order.stitch_count) }}<br>
                                                    <strong>Farben:</strong> {{ order.thread_colors or 'Standard' }}<br>
                                                    <strong>Position:</strong> {{ order.position or 'Brust' }}
                                                </small>
                                            {% elif order.order_type == 'printing' %}
                                                <small>
                                                    <strong>Druckart:</strong> {{ order.print_method or 'DTF' }}<br>
                                                    <strong>Größe:</strong> {{ order.print_width_cm }}×{{ order.print_height_cm }} cm<br>
                                                    <strong>Farben:</strong> {{ order.print_colors or 'Vollfarbe' }}
                                                </small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="packed">
                                                <label class="form-check-label" for="packed">
                                                    Verpackt
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {% if order.special_instructions %}
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <h5><i class="bi bi-exclamation-triangle"></i> Besondere Hinweise</h5>
                            <div class="alert alert-warning">
                                {{ order.special_instructions }}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="row mb-4">
                        <div class="col-md-12">
                            <h5><i class="bi bi-check-square"></i> Packvorgang</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="quality_check">
                                        <label class="form-check-label" for="quality_check">
                                            ✓ Qualitätskontrolle durchgeführt
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="complete_check">
                                        <label class="form-check-label" for="complete_check">
                                            ✓ Vollständigkeit geprüft
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="packaging_check">
                                        <label class="form-check-label" for="packaging_check">
                                            ✓ Verpackung geprüft
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="address_check">
                                        <label class="form-check-label" for="address_check">
                                            ✓ Lieferadresse bestätigt
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="label_check">
                                        <label class="form-check-label" for="label_check">
                                            ✓ Versandetikett angebracht
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="final_check">
                                        <label class="form-check-label" for="final_check">
                                            ✓ Versandbereit
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Verpackt von:</strong> _________________________</p>
                            <p><strong>Datum/Uhrzeit:</strong> _________________________</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Kontrolliert von:</strong> _________________________</p>
                            <p><strong>Unterschrift:</strong> _________________________</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nur bei Ansicht, nicht beim Drucken -->
            <div class="mt-3 d-print-none">
                <button onclick="window.print()" class="btn btn-primary">
                    <i class="bi bi-printer"></i> Drucken
                </button>
                <a href="{{ url_for('shipping.index') }}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Zurück
                </a>
            </div>
        </div>
    </div>
</div>

<style>
@media print {
    .d-print-none {
        display: none !important;
    }
    
    .card {
        border: none !important;
        box-shadow: none !important;
    }
    
    body {
        font-size: 12px;
    }
    
    h2 {
        font-size: 1.5rem;
    }
    
    h5 {
        font-size: 1.1rem;
    }
}
</style>
{% endblock %}