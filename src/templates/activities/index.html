{% extends "base.html" %}

{% block title %}Aktivitäts-Log - StitchAdmin{% endblock %}

{% block content %}
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<div class="row">
    <div class="col-md-12">
        <h1><i class="bi bi-journal-text"></i> Aktivitäts-Log</h1>
        
        <!-- Filter -->
        <div class="card mb-3">
            <div class="card-body">
                <form method="GET" class="row g-3">
                    <div class="col-md-4">
                        <label for="user" class="form-label">Nach Benutzer filtern</label>
                        <input type="text" class="form-control" id="user" name="user" value="{{ filter_user }}" placeholder="Benutzername">
                    </div>
                    <div class="col-md-4">
                        <label for="action" class="form-label">Nach Aktion filtern</label>
                        <select class="form-control" id="action" name="action">
                            <option value="">Alle Aktionen</option>
                            <option value="login" {% if filter_action == 'login' %}selected{% endif %}>Login</option>
                            <option value="logout" {% if filter_action == 'logout' %}selected{% endif %}>Logout</option>
                            <option value="create_user" {% if filter_action == 'create_user' %}selected{% endif %}>Benutzer erstellt</option>
                            <option value="update_user" {% if filter_action == 'update_user' %}selected{% endif %}>Benutzer aktualisiert</option>
                            <option value="delete_user" {% if filter_action == 'delete_user' %}selected{% endif %}>Benutzer gelöscht</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">&nbsp;</label>
                        <div>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-funnel"></i> Filtern
                            </button>
                            <a href="{{ url_for('activities.index') }}" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Zurücksetzen
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Aktivitäts-Tabelle -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Zeitstempel</th>
                                <th>Benutzer</th>
                                <th>Aktion</th>
                                <th>Details</th>
                                <th>IP-Adresse</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for activity in activities %}
                            <tr>
                                <td>
                                    <small>{{ activity.timestamp|format_date or '-' }}<br>{{ activity.timestamp|format_time or '-' }}:{{ activity.timestamp.strftime('%S') if activity.timestamp else '00' }}</small>
                                </td>
                                <td>
                                    <a href="?user={{ activity.username }}">{{ activity.username }}</a>
                                </td>
                                <td>
                                    <span class="badge 
                                        {% if activity.action == 'login' %}bg-success
                                        {% elif activity.action == 'logout' %}bg-info
                                        {% elif activity.action == 'create_user' %}bg-primary
                                        {% elif activity.action == 'delete_user' %}bg-danger
                                        {% else %}bg-secondary{% endif %}">
                                        {{ activity.action }}
                                    </span>
                                </td>
                                <td>{{ activity.details }}</td>
                                <td><small class="text-muted">{{ activity.ip_address }}</small></td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="text-center text-muted">
                                    Keine Aktivitäten gefunden
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="mt-3">
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Zurück zum Dashboard
            </a>
        </div>
    </div>
</div>

<script>
// Auto-Aktualisierung alle 30 Sekunden
setInterval(function() {
    if (!document.querySelector('input:focus, select:focus')) {
        location.reload();
    }
}, 30000);
</script>
{% endblock %}